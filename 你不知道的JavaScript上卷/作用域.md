# 作用域

## 第一章 作用域是什么


将变量引入到程序会引发一些问题：变量储存在哪，程序需要如何找到它们？这些问题说明需要一套设计良好的规则来存储变量，且之后可以方便找到这些变量，这套规则被称为作用域。

在哪里且怎么设置这些作用域规则呢？

### 编译原理

JavaScript是一门编译语言，但与传统编程语言不通，他不是提前编译，编译结果不能进行移植。编译过程同样经过：分词/词法分析、解析/语法分析、代码生成三个阶段，具体如下。

比起编译过程只有这三个阶段的语言的编译器，JavaScript引擎复杂得多。（比如在语法分析和代码生成阶段有特定步骤来运行性能优化）

**1. 分词/词法分析**

将由字符组成的字符串分解成有意义的代码块，这些代码块叫“词法单元”。例如：程序var a = 2;会被分解为下面这些词法单元：var、a、=、2;


**2. 解析/语法分析**

将词法单元组（数组）转换为一个由元素逐级嵌套所组成的代表程序语法的结构树(抽象语法树AST)。var a = 2;的抽象语法树中可能有一个叫AssignmentExpression的子节点，该节点有一个叫NumericLiteral（值为2）的子节点。

**3. 代码生成**


将AST转换为可执行代码。即可以将var a = 2;的AST转换为一组机器指令，用来创建一个叫a的变量(包括分配内存等）,并将一个值储存在a中。


### 理解作用域


#### 1. 引擎

从头负责整个JavaScript程序的编译及执行过程。

#### 2. 编译器

负责语法分析及代码生成。

#### 3. 作用域

负责收集并维护由所有声明的标识符（变量）组成的一系列查询，并实施一套严格规则，确定当前执行代码对这些标识符的访问权限。

**var a = 2;发生了什么？**

编译器首先会在作用域中声明一个变量（如果之前没有声明过），接下来编译器会为引擎生成运行时所需的代码，这些代码用来处理a = 2这个赋值操作，然后在引擎运行时，引擎会在作用域中查找该变量，如果找到就执行赋值操作，否则就抛出异常。

**一些编译器术语**

- LHS。 当变量出现在赋值操作的左侧时进行LHS查询，试图找到变量容器本身从而可以对其赋值。
- RHS。 当变量出现在赋值操作的右侧时进行RHS查询，和简单地查找某个变量的值无异，取到它的源值。

```javascript
console.log(a); // RHS
a = 2; // LHS
```